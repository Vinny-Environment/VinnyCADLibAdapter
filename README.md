# VinnyCADLibAdapter

Adapter for CSoft CADLib: Модель и Архив (импорт и ~~экспорт~~)

https://github.com/Vinny-Environment/VinnyCADLibAdapter

# Установка

Файлы плагина к CSoft CADLib: Модель и Архив расположены в папке `plugins\cadlib` пакета `VinnyLibConverter`(см. [здесь](https://github.com/Vinny-Environment/VinnyLibConverter#%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0))
Плагин может быть установлен одинаково на версии стандартного CADLib и CADLib DX.
Плагин разрабатывался и тестировался на версии CADLib 3.2.520.2899 (декабрь 2023г).

Для загрузки плагина в CADLib необходимы права администратора (если путь установки CADLib системный по умолчанию в `C:\Program Files...`).

1. Зайти в текстовый файл `C:\Program Files (x86)\CSoft\Model Studio CS\Viewer\bin\x64\plugins.xml`;
2. Добавить в конце в блок `Plugins` новую запись вида `<Plugin name="C:\Users\Georg\Documents\GitHub\VinnyLibBin\Debug\plugins\cadlib\VinnyCADLibLoader.dll" />`, где путь в кавычках указать полный файловый путь к библиотеке `VinnyCADLibLoader.dll` в Вашей папке с развернутым дистрибутивом VinnyLibConverter.
3. Сохранить файл и перезапустить CADLib.

Для CADLib DX действия аналогичны.
Если всё сделано корректно, то в CADLib появится лента `Vinny` с двумя командами на импорт и экспорт данных, активных при загрузке какой-либо модели и справочная команда "О плагине".

# Использование

## Импорт

Импорт объектов осуществляется без учета структуры, реализовать её программно крайне трудоёмко и пока отложено на TODO. Все объекты располагаются в стандартной группе "Не определено" CADLib.

Дополнительно создается новый миникаталог в группе миникаталогов "Объекты созданные через VinnyConverter" с именем импортируемого файла и датой начала импорта. В миникаталоге сохранена полная структура данных из оригинального импортируемого файла. Доступен вызов контекстного меню с опциями "Отобразить на 3D" и т.д.

### Указание типа (категории) объекта

Тип (категория) объекта CADLib по умолчанию для создаваемых объектов будет пользовательский "VinnyObject". 

При желании переопределить тип (категорию), используйте параметр **VinnyCADLibObjectType**, значением которого должно выступать один из типов (категорий) объектов для используемой БД. Перечень категорий объектов см. в таблице БД CADLib "ObjectCategories", используйте поле Name для отдельной записи таблицы "ObjectCategories", указывая его в значении параметра **VinnyCADLibObjectType** у соответствующего объекта.

Основные категории приведены в перечне ниже (ключом словаря выступает Name, а значением -- Caption таблицы ObjectCategories)

```json
{
  "structure_data": "Структурные данные",
  "COLLISIONS": "Коллизии",
  "nodes": "Контакты",
  "assemblies": "Сборки",
  "garlandMisc": "Детали гирлянд",
  "suppressor": "Гасители вибрации",
  "units": "Оборудование",
  "towerequipment": "Комплект оборудования",
  "metalware": "Металлоконструкции",
  "symbol": "Элемент схемы",
  "decoration": "Элементы оформления",
  "HVAC": "Вентиляция",
  "aec_elements": "Строительные элементы",
  "ground": "Грунт",
  "AEC_SURF": "Строительная поверхность",
  "foundation": "Фундамент",
  "cables": "Кабели",
  "HVACAxis": "Осевая вентиляции",
  "metalwarenode": "Узел Металлоконструкций",
  "device": "Прибор",
  "wires": "Провода",
  "iron_assemblies": "Сборки металлоконструкций",
  "TRAYS": "Кабельные конструкции",
  "wire": "Провод",
  "REINFORCEMENT": "Строительная арматура",
  "node": "Контакт",
  "routeConstructionsAssemblies": "Сборки прототипов",
  "routeConstructions": "Конструкции прототипов",
  "aec_layer_material": "Строительный слой",
  "cat47": "Железобетонные конструкции",
  "concreteware": "Железобетонные изделия",
  "tank_eq_schm": "Элементы оборудования схем",
  "catDiameterList": "Перечень диаметров",
  "assembly": "Сборка",
  "cabinet": "Щит",
  "panels": "Панели шкафа",
  "Cable_ETS": "Кабель_ЭТС",
  "WireDefault": "Другие провода",
  "valve_prototype": "Прототип комплекта",
  "pipeAxis": "Осевая трубопровода",
  "bolts": "Крепежные изделия",
  "pipeItems": "Детали трубопроводов",
  "tank_equip": "Элементы оборудования",
  "Insulation": "Изоляция",
  "catPipeSupportStepData": "Трубопроводы. Шаг опор",
  "HVACPipeItems": "Компоненты вентиляции",
  "AEC_WALL": "Стена"
}
```

## Экспорт

Функция экспорта на данный момент работает не корректно (вы, конечно, можете ей воспользоваться).
Проблемы с чтением геометрии CSMesh (некорректная триангуляция). Проблема с получением иерархии по структуре (поэтому экспортируются ВСЕ данные модели CADLib)

# Dev

Состоит из двух проектов:

* `VinnyCADLibLoader`: загрузчик в CADLib;
* `VinnyCADLibAdapter`: основная логика плагина;

В проектах используются внешние зависимости на библиотеки CADLib `C:\Program Files (x86)\CSoft\Model Studio CS\Viewer\bin\x64\`;

# TODO

Решить ошибки API на экспорт (структура и геометрия)

Реализовать импорт с учетом структуры (назначить набор параметров и связей)
